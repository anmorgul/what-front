pipeline {
	agent { label 'nodejs'}
	stages {
		stage("ls") {
			steps {
				sh 'pwd'
				sh 'ls'
			}
		}
		// stage("Stage npm install") {
		// 	steps {
		// 		sh 'npm install'
		// 		println "${env.BRANCH_NAME}"
		// 	}
		// }
		// stage("Stage eslint + test") {
		// 	parallel {
		// 		stage("Stage eslint") {
		// 			steps {
		// 				catchError(buildResult: 'SUCCESS', stageResult: 'FAILURE') {
		// 						sh 'npx eslint .'
		// 					}
		// 				}
		// 			}
		// 		stage("Stage test") {
		// 			steps {
		// 				catchError(buildResult: 'SUCCESS', stageResult: 'FAILURE') {
		// 						sh 'npm run test'
		// 					}
		// 				}
		// 			}
		// 		}
		// 	}
		// stage("Stage build") {
		// 	steps {
		// 		sh 'npm run build'
		// 	}
		// }
		// stage('SonarQube analysis') {
		// 	environment {
		// 		def scannerHome = tool 'SonarQubeScannerMaven';
		// 	}
		// 	steps {
		// 		withSonarQubeEnv('SonarQube9000') {
		// 			withCredentials([string(credentialsId: 'sonarProjectKey', variable: 'sonarProjectKey')]) {
		// 				echo "${sonarProjectKey}"
		// 				sh "${scannerHome}/bin/sonar-scanner -Dsonar.projectKey=jenkins_what_front"
		// 			}
		// 		}
		// 		// -Dsonar.login=66c6d51eb60150c34139d8552ba6e3afb1be3df4
		// 		// -Dsonar.projectKey=${sonartoken}
		// 	}
		// }
		// stage("Quality Gate") {
		// 	steps {
		// 		timeout(time: 1, unit: 'HOURS') {
		// 			waitForQualityGate abortPipeline: true
		// 		}
		// 	}
		// }
		stage('branch is master') {
            when {
                branch 'fakemaster'
            }
            steps {
				echo "branch fakemaster"
            }
        }
		stage('branch is dev') {
            when {
                branch 'fakedev'
            }
            steps {
				echo "branch fakedev"
            }
        }
		// stage('Deploy Master') {
		// 	when {expression { env.BRANCH_NAME == 'master' }}
		// 		steps {
		// 		  sh '''
        //                            #!/bin/bash
        //                            echo Deploying in master....
        //                            '''
		// 		}
		// }
		stage('ttt') {
            steps {
				telegramSend(message: 'Hello World', chatId: 1001721361023)
				sh '''
					curl -s -X POST https://api.telegram.org/bot5057295016:AAFWX5eitw9tKyiPtLB1FWYI3iVvP5Fmt4g/sendMessage -d chat_id='-1001721361023' -d parse_mode=markdown -d text='some text'
				'''
            }
        }
  	}
	post {
		success {   
			echo "success"        
			telegramSend 'Hello World' 
		}
		aborted {             
            steps {
				echo "aborted"
            }
		}
		failure {
            steps {
				echo "failure"
            }
		}
	}
}
